{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Created by user on 2018/2/14/014.\n */\n\nimport Promise = require('bluebird');\nimport Bluebird = require('bluebird');\n// @ts-ignore\nimport path = require('upath2');\nexport { path }\n\nimport StrUtil = require('str-util');\nexport * from './options';\nimport { IOptions, defaultPatternsExclude, getOptions, getOptionsRuntime, getOptions2 } from './options';\nexport { IOptions, defaultPatternsExclude, getOptions, getOptionsRuntime, getOptions2 }\n\nimport libSort = require('./sort');\n\nimport { normalize_strip, normalize_val } from './helper';\n\nexport { normalize_val }\n\nimport * as globby from 'globby';\nimport { sortTree } from './glob-sort';\n\nimport { sort as globTreeListUtilSort } from 'glob-tree-list/lib/util';\nimport { glob_to_list_array, glob_to_list_array_deep, pathToListRow } from './list';\nimport { IArrayDeepInterface, IArrayDeep, IForeachArrayDeepCache, IForeachArrayDeepReturn, foreachArrayDeepAsync, eachVolumeTitle, foreachArrayDeep } from './util';\nexport { IArrayDeepInterface, IArrayDeep, IForeachArrayDeepCache, IForeachArrayDeepReturn, foreachArrayDeepAsync, eachVolumeTitle, foreachArrayDeep }\n\nexport { pathToListRow }\n\nexport interface IApi<T>\n{\n\t(options: IOptions): T\n\n\t(patterns?: string[], options?: IOptions): T\n}\n\nexport type IApiSync = IApi<IReturnList>;\nexport type IApiAsync = IApi<Bluebird<IReturnList>>;\n\nexport interface IApiWithReturnGlob<T>\n{\n\t(options: IOptionsWithReturnGlobList): T\n\n\t(patterns?: string[], options?: IOptionsWithReturnGlobList): T\n}\n\nexport type IApiWithReturnGlobSync = IApiWithReturnGlob<IReturnGlob>;\nexport type IApiWithReturnGlobAsync = IApiWithReturnGlob<Bluebird<IReturnGlob>>;\n\nexport type IOptionsWithReturnGlobList = IOptions & IReturnGlobListOptions;\n\nexport type IReturnGlob = string[];\n\nexport interface IReturnRow\n{\n\tsource_idx: number,\n\tsource_path: string,\n\tpath: string,\n\tpath_dir: string,\n\tdir: string,\n\tfile: string,\n\text: string,\n\tvolume_title: string,\n\tchapter_title: string,\n\tval_file: string,\n\tval_dir: string,\n}\n\nexport interface IReturnList\n{\n\t[index: number]: IReturnRow[],\n\t[key: string]: IReturnRow[],\n}\n\nexport interface IReturnList2\n{\n\t/*\n\t[key: string]: {\n\t\t[index: number]: IReturnRow,\n\t\t[key: string]: IReturnRow,\n\t},\n\t*/\n\t[key: string]: IReturnRow[],\n\t[index: number]: IReturnRow[],\n}\n\nexport function createGlobToType<T>(fn: (glob_ls: string[], options?: IOptions) => T)\n{\n\treturn function (glob_ls: string[], options: IOptions = {})\n\t{\n\t\tif (!Array.isArray(glob_ls) || !glob_ls.length)\n\t\t{\n\t\t\tif (options.throwEmpty)\n\t\t\t{\n\t\t\t\tthrow new Error(`glob matched list is empty`);\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\tlet comp = options.sortCallback || libSort.defaultSortCallback;\n\n\t\tlet ls = sortTree(glob_ls, comp as any, options);\n\n\t\treturn fn(ls, options);\n\t};\n}\n\n/**\n * @deprecated\n */\nexport const globToList = createGlobToType<IReturnList2>(glob_to_list);\n\nexport const globToListArray = createGlobToType(glob_to_list_array);\n\nexport const globToListArrayDeep = createGlobToType(glob_to_list_array_deep);\n\nexport interface IReturnGlobListOptions\n{\n\tuseSourcePath?: boolean,\n}\n\nexport function returnGlobList(ls: IReturnList, options: IReturnGlobListOptions & IOptions = {}): string[]\n{\n\tlet useSourcePath = (options.useSourcePath === true || options.useSourcePath === false)\n\t\t? options.useSourcePath\n\t\t: !options.absolute;\n\n\tif (!ls)\n\t{\n\t\treturn [];\n\t}\n\n\treturn Object.values(ls)\n\t\t.reduce(function (a: string[], b)\n\t\t{\n\t\t\tObject.values(b)\n\t\t\t\t.forEach(function (value, index, array)\n\t\t\t\t{\n\t\t\t\t\ta.push(useSourcePath ? value.source_path : value.path);\n\t\t\t\t})\n\t\t\t;\n\n\t\t\treturn a;\n\t\t}, [])\n\t\t;\n\n\t/*\n\treturn Object.keys(ls)\n\t\t.reduce(function (a: string[], b)\n\t\t{\n\t\t\tls[b].forEach(function (value, index, array)\n\t\t\t{\n\t\t\t\ta.push(useSourcePath ? value.source_path : value.path);\n\t\t\t});\n\n\t\t\treturn a;\n\t\t}, [])\n\t\t;\n\t*/\n}\n\nexport function glob_to_list(glob_ls: string[], options: IOptions = {}): IReturnList2\n{\n\tif (!Array.isArray(glob_ls) || !glob_ls.length)\n\t{\n\t\tthrow new Error(`glob matched list is empty`);\n\t}\n\n\toptions = getOptionsRuntime({\n\t\t...options,\n\t});\n\n\t//console.log(glob_ls);\n\n\treturn glob_ls.reduce(function (a: IReturnList2, b: string, source_idx: number)\n\t{\n\t\tlet row = pathToListRow(b, source_idx, options);\n\n\t\tif (options.onListRow)\n\t\t{\n\t\t\trow = options.onListRow<IReturnList2>(a, row, options);\n\n\t\t\tif (!row)\n\t\t\t{\n\t\t\t\tthrow new Error('onListRow');\n\t\t\t}\n\t\t}\n\n\t\t// 防止純數字的資料夾名稱導致排序失敗\n\t\tlet key = row.val_dir + '.dir';\n\n\t\ta[key] = a[key] || [];\n\t\ta[key].push(row);\n\n\t\treturn a;\n\t}, {} as IReturnList2);\n}\n\n/*\nexport function _p_sort_list1(ls: IReturnList2, options: IOptions = {})\n{\n\tlet ks = Object.keys(ls)\n\t\t.reduce(function (a, b)\n\t\t{\n\t\t\ta[StrUtil.zh2num(b)] = b;\n\n\t\t\treturn a;\n\t\t}, {})\n\t;\n\n\tlet ks2 = Object.keys(ks);\n\n\tif (options && options.sortFn)\n\t{\n\t\tks2 = options.sortFn(ks2);\n\t}\n\telse if (!options || !options.disableSort)\n\t{\n\t\tks2.sort(options && options.sortCallback);\n\t}\n\n\tlet ks3 = ks2.reduce(function (a, b)\n\t{\n\t\tlet key = ks[b];\n\n\t\ta[key] = ls[key];\n\n\t\treturn a;\n\t}, {});\n\n\treturn ks3;\n}\n\nexport function _p_sort_list2(ls, options: IOptions = {}): IReturnList\n{\n\tfor (let dir in ls)\n\t{\n\t\tlet a = Object.keys(ls[dir]);\n\n\t\tif (options && options.sortFn)\n\t\t{\n\t\t\ta = options.sortFn(a);\n\t\t}\n\t\telse if (!options || !options.disableSort)\n\t\t{\n\t\t\ta.sort(options && options.sortCallback);\n\t\t}\n\n\t\tls[dir] = Object.values(a.reduce(function (a, b)\n\t\t{\n\t\t\ta[b] = ls[dir][b];\n\n\t\t\treturn a;\n\t\t}, {}));\n\t}\n\n\treturn ls;\n}\n*/\n\nexport function p_sort_list(ls: IReturnList2, options: IOptions = {}): IReturnList\n{\n\t/*\n\tlet ret = _p_sort_list1(ls, options);\n\n\treturn _p_sort_list2(ret, options);\n\t*/\n\treturn sortList2(ls, options);\n}\n\nexport function sortList2(ls: IReturnList2, options: IOptions = {})\n{\n\tlet comp = options.sortCallback || libSort.defaultSortCallback;\n\n\tlet ls2 = Object.entries(ls);\n\n\tif (options && options.sortFn)\n\t{\n\t\tls2 = options.sortFn(ls2);\n\t}\n\telse if (!options || !options.disableSort)\n\t{\n\t\tls2.sort(function (a, b)\n\t\t{\n\t\t\treturn comp(a[0], b[0]);\n\t\t});\n\t}\n\n\treturn ls2\n\t\t/*\n\t\t.sort(function (a, b)\n\t\t{\n\t\t\treturn comp(a[0], b[0]);\n\t\t})\n\t\t*/\n\t\t.reduce(function (a, entries)\n\t\t{\n\t\t\tlet dir: string;\n\n\t\t\tlet ls2 = Object.values(entries[1])\n\t\t\t\t.sort(function (a, b)\n\t\t\t\t{\n\t\t\t\t\t//console.log(a.val_file, b.val_file);\n\n\t\t\t\t\treturn comp(a.val_file, b.val_file);\n\t\t\t\t})\n\t\t\t\t;\n\n\t\t\t//console.log(ls2);\n\n\t\t\tlet ls = ls2\n\t\t\t\t.reduce(function (a, row)\n\t\t\t\t{\n\t\t\t\t\tdir = row.dir;\n\n\t\t\t\t\t//a[row.file.toString()] = row;\n\t\t\t\t\ta.push(row);\n\n\t\t\t\t\treturn a;\n\t\t\t\t}, [])\n\t\t\t;\n\n\t\t\t// 防止純數字的資料夾名稱導致排序失敗\n\t\t\ta[dir + '.dir'] = ls;\n\n\t\t\treturn a;\n\t\t}, {})\n\t;\n}\n\nexport default exports as typeof import('./index');\n"]}